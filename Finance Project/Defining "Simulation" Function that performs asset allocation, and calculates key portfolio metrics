# The function receives: 
    # (1) portfolio weights
    # (2) initial investment amount
# The function returns: 
    # (1) Expected portfolio return 
    # (2) Expected volatility 
    # (3) Sharpe ratio 
    # (4) Return on investment 
    # (5) Final portfolio value in dollars
def simulation_engine(weights, initial_investment):
portfolio_df = asset_allocation(close_price_df, weights, initial_investment)
return_on_investment = ((portfolio_df['Portfolio Value [$]'][-1:] -  portfolio_df['Portfolio Value [$]'][0])/ portfolio_df['Portfolio Value [$]'][0]) * 100
portfolio_daily_return_df = portfolio_df.drop(columns = ['Date', 'Portfolio Value [$]', 'Portfolio Daily Return [%]'])
portfolio_daily_return_df = portfolio_daily_return_df.pct_change(1) 
expected_portfolio_return = np.sum(weights * portfolio_daily_return_df.mean() ) * 252
covariance = portfolio_daily_return_df.cov() * 252 
expected_volatility = np.sqrt(np.dot(weights.T, np.dot(covariance, weights)))
rf = 0.03 # Try to set the risk free rate of return to 1% (assumption)
#Sharpe ratio
sharpe_ratio = (expected_portfolio_return - rf)/expected_volatility 
return expected_portfolio_return, expected_volatility, sharpe_ratio, portfolio_df['Portfolio Value [$]'][-1:].values[0], return_on_investment.values[0]
initial_investment = 1000000
portfolio_metrics = simulation_engine(weights, initial_investment)
print('Expected Portfolio Annual Return = {:.2f}%'.format(portfolio_metrics[0] * 100))
print('Portfolio Standard Deviation (Volatility) = {:.2f}%'.format(portfolio_metrics[1] * 100))
print('Sharpe Ratio = {:.2f}'.format(portfolio_metrics[2]))
print('Portfolio Final Value = ${:.2f}'.format(portfolio_metrics[3]))
print('Return on Investment = {:.2f}%'.format(portfolio_metrics[4]))
